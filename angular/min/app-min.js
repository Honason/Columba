var columbaApp=angular.module("columbaApp",["ngRoute","ngResource","ngStorage"]);columbaApp.config(["$routeProvider","$httpProvider",function(e,o){e.when("/",{templateUrl:"angular/pages/dashboard.html",controller:"dashboardController",reloadOnSearch:!1}).when("/login",{templateUrl:"angular/pages/login.html",controller:"loginController"}).when("/register",{templateUrl:"angular/pages/register.html",controller:"loginController"}),o.interceptors.push(["$q","$location","$localStorage",function(e,o,t){return{request:function(e){return e.headers=e.headers||{},t.token&&(e.headers.Authorization=t.token),e},responseError:function(t){return(401===t.status||403===t.status)&&o.path("/login"),e.reject(t)}}}])}]),columbaApp.service("dataService",["$log",function(e){var o=this;this.lastPath="empty",this.currentPath="empty",this.SetLastPath=function(e){o.lastPath=e.replace("/","")}}]),columbaApp.service("userService",["$http",function(e){this.GetAllUsers=function(o){e.post("/users/getall").success(function(e){o(e)})}}]),columbaApp.service("authService",["$http","$log","$localStorage","$location","$timeout","transitionService",function(e,o,t,a,r,n){var s=this;this.Register=function(t,a,n){e.post("users/register",{name:t,email:a,password:n}).success(function(e){e.success&&r(function(){s.Login(a,n)},500)}).error(function(e){o.log(e)})},this.Login=function(a,r){e.post("/users/login",{email:a,password:r}).success(function(e){e&&(t.token=e.token,t.userName=e.name,n.GoToPage("/"))}).error(function(e){o.log(e)})},this.IsEmailRegistered=function(o,t){o?e.post("users/isemailregistered",{email:o}).success(function(e){t(e.emailRegistered)}):t(!1)},this.EnsureAuthenticated=function(){return t.token?t.userName:(a.path("/login"),!1)},this.Logout=function(){t.$reset(),n.GoToPage("/login")}}]),columbaApp.service("transitionService",["$log","$timeout","$location","dataService",function(e,o,t,a){this.animPrepare="prep";var r=this;this.GoToPage=function(e){a.lastPath=a.currentPath,a.currentPath=e.replace("/","");var r=a.lastPath,n=a.currentPath,s=.4;"register"===r&&"login"===n||"login"===r&&"register"===n?TweenLite.to(".login-group",s,{y:-150,opacity:0,ease:Power3.easeIn}):"login"===r&&""===n?(s=.3,TweenMax.to([".login-group",".columba-login-logo"],.25,{y:"-200px",opacity:0,ease:Power2.easeIn})):""===r&&"login"===n&&(s=.7,TweenMax.fromTo([".right-menu",".left-menu"],.4,{opacity:1,y:0},{opacity:0,y:-10}),TweenMax.fromTo(".paper-parent",.7,{opacity:1,y:0},{opacity:0,y:200,ease:Power3.easeIn}),TweenMax.to(".header",.7,{height:window.innerHeight,ease:Power3.easeIn})),o(function(){t.path(e)},1e3*s)},this.CheckPreviousState=function(){a.currentPath=t.path().replace("/","");var n=a.lastPath,s=a.currentPath;e.log("Previous: "+n+", Current: "+s),"register"===n&&"login"===s||"login"===n&&"register"===s?TweenLite.from(".login-group",.5,{y:150,opacity:0,ease:Power3.easeOut}):"login"===n&&""===s?(r.animPrepare="prepare bigHeader",TweenMax.to(".blueHeader",0,{height:window.innerHeight}),angular.element(document).ready(function(){TweenMax.to(".paper-parent",1,{marginTop:-50,ease:Power3.easeOut}),TweenMax.to(".paper-parent",.5,{opacity:1}),TweenMax.to(".blueHeader",0,{height:150}),o(function(){TweenMax.fromTo([".right-menu",".left-menu"],1,{opacity:0,y:-10},{opacity:1,y:0}),TweenMax.fromTo(".header",.6,{height:window.innerHeight},{height:150,ease:Power3.easeInOut})},30)})):""===n&&"login"===s&&(r.animPrepare="prepare",angular.element(document).ready(function(){TweenLite.fromTo([".login-group",".columba-login-logo"],.4,{opacity:0,y:-200},{opacity:1,y:0,ease:Power3.easeOut})})),o(function(){r.animPrepare=""},1200)},this.OpenProposal=function(){"empty"===a.lastPath&&""!==a.currentPath?(r.animPrepare="proposal-direct",angular.element(document).ready(function(){o(function(){TweenMax.to(".proposal-wrapper",0,{css:{display:"block"}})},200)})):(TweenMax.to(".proposal-paper",0,{y:window.innerHeight,opacity:1,scale:1}),TweenMax.to(".proposal-wrapper",0,{css:{display:"block"}}),TweenMax.to(".proposal-paper",.4,{y:0,ease:Power3.easeOut}))},this.DeleteProposal=function(){TweenMax.to(".proposal-paper",.4,{y:30,opacity:0,scale:.8,ease:Power3.easeIn}),TweenMax.to(".proposal-wrapper",0,{css:{display:"none"},delay:.5})},this.CloseProposal=function(){TweenMax.to(".proposal-paper",.4,{y:window.innerHeight,ease:Power3.easeIn}),TweenMax.to(".proposal-wrapper",0,{css:{display:"none"},delay:.5}),o(function(){r.CloseDetail()},500)},this.OpenDetail=function(e){var o=$("#"+e+" .paper-down");TweenMax.to(o,0,{css:{display:"block"}}),$("#"+e+" div.trigger").css("display","none"),$("#"+e+" .text-button.hidden").css("display","block")},this.CloseDetail=function(e){var o="";e&&(o="#"+e);var t=$(o+" .paper-down");TweenMax.to(t,0,{css:{display:"none"}}),$(o+" div.trigger").css("display","block"),$(o+" .text-button.hidden").css("display","none")}}]),columbaApp.service("proposalService",["$http","$location",function(e,o){this.loadedProposal={};var t=this;this.createProposal=function(){e.post("proposals/create-proposal").success(function(e){e.success&&o.path("/").search({pId:e.proposal.proposalId})})},this.openProposal=function(a){e.post("proposals/get-proposal",{id:a}).success(function(e){e.success&&(t.loadedProposal=e)}),o.path("/").search({pId:a})},this.getProposals=function(o){e.post("/proposals/get-proposals").success(function(e){o(e.proposals)})},this.deleteProposal=function(o){e.post("/proposals/delete-proposal",{id:t.loadedProposal.proposal._id}).success(function(e){console.log(e),o()})},this.saveSection=function(o){if("supplier"===o){var a=t.loadedProposal.supplier;e.post("proposals/update-proposal-section",{section:"supplier",id:a._id,name:a.name,address:a.address,city:a.city,zipCode:a.zipCode,country:a.country,vatNumber:a.vatNumber,phone:a.phone}).success(function(e){})}},this.cancelSection=function(o){if("supplier"===o){var a=t.loadedProposal.supplier._id;e.post("proposals/get-contact",{id:a}).success(function(e){t.loadedProposal.supplier=e.contact})}}}]),columbaApp.controller("loginController",["$scope","$location","$log","authService","dataService","transitionService",function(e,o,t,a,r,n){e.transitionService=n,n.CheckPreviousState(),e.dataService=r,e.login=function(){a.Login(e.email,e.password)},e.register=function(){a.Register(e.newName,e.newEmail,e.newPassword)},e.emailregistered=!1,e.$watch("newEmail",function(){a.IsEmailRegistered(e.newEmail,function(o){e.emailregistered=o})})}]),columbaApp.controller("dashboardController",["$scope","authService","userService","$location","$log","dataService","transitionService","proposalService",function(e,o,t,a,r,n,s,i){e.authService=o,e.transitionService=s,e.createProposal=i.createProposal,e.openProposal=i.openProposal,e.proposalService=i;var p=o.EnsureAuthenticated();if(p){e.userName=p,e.$on("$routeUpdate",function(){l(!0)});var l=function(o){a.search().pId?(s.OpenProposal(),i.openProposal(a.search().pId)):(i.getProposals(function(o){e.proposals=o}),t.GetAllUsers(function(o){e.users=o}))};l(!1),e.closeEdit=function(e,o){s.CloseDetail(e),o?i.saveSection(e):i.cancelSection(e)},e.deleteProposal=function(){i.deleteProposal(function(){a.url("/#"),s.DeleteProposal()})},s.CheckPreviousState()}}]),columbaApp.directive("appHeader",function(){return{templateUrl:"angular/directives/header.html",replace:!0}}),columbaApp.directive("proposalItem",function(){return{templateUrl:"angular/directives/proposal-item.html",replace:!0,scope:{cProposal:"=",openMethod:"&"}}}),columbaApp.directive("proposal",function(){return{templateUrl:"angular/directives/proposal.html",replace:!0}});
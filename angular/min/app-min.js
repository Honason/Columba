var columbaApp=angular.module("columbaApp",["ngRoute","ngResource","ngStorage","ngAnimate"]);columbaApp.config(["$routeProvider","$httpProvider",function(e,t){e.when("/",{templateUrl:"angular/pages/dashboard.html",controller:"dashboardController",reloadOnSearch:!1}).when("/login",{templateUrl:"angular/pages/login.html",controller:"loginController"}).when("/register",{templateUrl:"angular/pages/register.html",controller:"loginController"}),t.interceptors.push(["$q","$location","$localStorage",function(e,t,r){return{request:function(e){return e.headers=e.headers||{},r.token&&(e.headers.Authorization=r.token),e},responseError:function(r){return(401===r.status||403===r.status)&&t.path("/login"),e.reject(r)}}}])}]),columbaApp.service("dataService",["$log",function(e){var t=this;this.lastPath="empty",this.currentPath="empty",this.SetLastPath=function(e){t.lastPath=e.replace("/","")}}]),columbaApp.service("transitionService",["$log","$timeout","$location","dataService",function(e,t,r,o){this.GoToPage=function(e){o.lastPath=o.currentPath,o.lastPath+=" anim-exit",o.currentPath=e.replace("/",""),t(function(){r.path(e)},200)},this.CheckPreviousState=function(){o.lastPath=o.lastPath.replace(" anim-exit",""),o.currentPath=r.path().replace("/",""),"empty"!==o.lastPath&&(o.lastPath+=" anim-start")}}]),columbaApp.service("userService",["$http",function(e){this.GetAllUsers=function(t){e.post("/users/getall").success(function(e){t(e)})}}]),columbaApp.service("authService",["$http","$log","$localStorage","$location","$timeout","transitionService",function(e,t,r,o,n,a){var i=this;this.Register=function(r,o,a){e.post("users/register",{name:r,email:o,password:a}).success(function(e){e.success&&n(function(){i.Login(o,a)},500)}).error(function(e){t.log(e)})},this.Login=function(o,n){e.post("/users/login",{email:o,password:n}).success(function(e){e&&(r.token=e.token,r.userName=e.name,a.GoToPage("/"))}).error(function(e){t.log(e)})},this.IsEmailRegistered=function(t,r){t?e.post("users/isemailregistered",{email:t}).success(function(e){r(e.emailRegistered)}):r(!1)},this.EnsureAuthenticated=function(){return r.token?r.userName:(o.path("/login"),!1)},this.Logout=function(){r.$reset(),o.path("/login")}}]),columbaApp.controller("loginController",["$scope","$location","$log","authService","dataService","transitionService",function(e,t,r,o,n,a){e.transitionService=a,a.CheckPreviousState(),e.dataService=n,e.login=function(){o.Login(e.email,e.password)},e.register=function(){o.Register(e.newName,e.newEmail,e.newPassword)},e.emailregistered=!1,e.$watch("newEmail",function(){o.IsEmailRegistered(e.newEmail,function(t){e.emailregistered=t})})}]),columbaApp.controller("dashboardController",["$scope","authService","userService","$location","$log","dataService","transitionService",function(e,t,r,o,n,a,i){e.authService=t;var s=t.EnsureAuthenticated();if(s){e.userName=s,e.$on("$routeUpdate",function(){l()});var l=function(){o.search().newProposal?n.log("New proposal."):r.GetAllUsers(function(t){e.users=t})};l()}}]),columbaApp.directive("appHeader",function(){return{templateUrl:"angular/directives/header.html",replace:!0}}),columbaApp.directive("proposalItem",function(){return{templateUrl:"angular/directives/proposal-item.html",replace:!0,scope:{user:"="}}});
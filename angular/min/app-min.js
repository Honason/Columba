var columbaApp=angular.module("columbaApp",["ngRoute","ngResource","ngStorage"]);columbaApp.config(["$routeProvider","$httpProvider",function(e,t){e.when("/",{templateUrl:"angular/pages/dashboard.html",controller:"dashboardController",reloadOnSearch:!1}).when("/login",{templateUrl:"angular/pages/login.html",controller:"loginController"}).when("/register",{templateUrl:"angular/pages/register.html",controller:"loginController"}),t.interceptors.push(["$q","$location","$localStorage",function(e,t,o){return{request:function(e){return e.headers=e.headers||{},o.token&&(e.headers.Authorization=o.token),e},responseError:function(o){return(401===o.status||403===o.status)&&t.path("/login"),e.reject(o)}}}])}]),columbaApp.service("dataService",["$log",function(e){var t=this;this.lastPath="empty",this.currentPath="empty",this.SetLastPath=function(e){t.lastPath=e.replace("/","")}}]),columbaApp.service("userService",["$http",function(e){this.GetAllUsers=function(t){e.post("/users/getall").success(function(e){t(e)})}}]),columbaApp.service("authService",["$http","$log","$localStorage","$location","$timeout","transitionService",function(e,t,o,r,a,n){var i=this;this.Register=function(o,r,n){e.post("users/register",{name:o,email:r,password:n}).success(function(e){e.success&&a(function(){i.Login(r,n)},500)}).error(function(e){t.log(e)})},this.Login=function(r,a){e.post("/users/login",{email:r,password:a}).success(function(e){e&&(o.token=e.token,o.userName=e.name,n.GoToPage("/"))}).error(function(e){t.log(e)})},this.IsEmailRegistered=function(t,o){t?e.post("users/isemailregistered",{email:t}).success(function(e){o(e.emailRegistered)}):o(!1)},this.EnsureAuthenticated=function(){return o.token?o.userName:(r.path("/login"),!1)},this.Logout=function(){o.$reset(),n.GoToPage("/login")}}]),columbaApp.service("transitionService",["$log","$timeout","$location","dataService",function(e,t,o,r){this.animPrepare="prep";var a=this;this.GoToPage=function(e){r.lastPath=r.currentPath,r.currentPath=e.replace("/","");var a=r.lastPath,n=r.currentPath,i=.4;"register"===a&&"login"===n||"login"===a&&"register"===n?TweenLite.to(".login-group",i,{y:-150,opacity:0,ease:Power3.easeIn}):"login"===a&&""===n?(i=.3,TweenMax.to([".login-group",".columba-login-logo"],.25,{y:"-200px",opacity:0,ease:Power2.easeIn})):""===a&&"login"===n&&(i=.7,TweenMax.fromTo([".right-menu",".left-menu"],.4,{opacity:1,y:0},{opacity:0,y:-10}),TweenMax.fromTo(".paper-parent",.7,{opacity:1,y:0},{opacity:0,y:200,ease:Power3.easeIn}),TweenMax.to(".header",.7,{height:window.innerHeight,ease:Power3.easeIn})),t(function(){o.path(e)},1e3*i)},this.CheckPreviousState=function(){r.currentPath=o.path().replace("/","");var n=r.lastPath,i=r.currentPath;e.log("Previous: "+n+", Current: "+i),"register"===n&&"login"===i||"login"===n&&"register"===i?TweenLite.from(".login-group",.5,{y:150,opacity:0,ease:Power3.easeOut}):"login"===n&&""===i?(a.animPrepare="prepare bigHeader",TweenMax.to(".blueHeader",0,{height:window.innerHeight}),angular.element(document).ready(function(){TweenMax.to(".paper-parent",1,{marginTop:-50,ease:Power3.easeOut}),TweenMax.to(".paper-parent",.5,{opacity:1}),TweenMax.to(".blueHeader",0,{height:150}),t(function(){TweenMax.fromTo([".right-menu",".left-menu"],1,{opacity:0,y:-10},{opacity:1,y:0}),TweenMax.fromTo(".header",.6,{height:window.innerHeight},{height:150,ease:Power3.easeInOut})},30)})):""===n&&"login"===i&&(a.animPrepare="prepare",angular.element(document).ready(function(){TweenLite.fromTo([".login-group",".columba-login-logo"],.4,{opacity:0,y:-200},{opacity:1,y:0,ease:Power3.easeOut})})),t(function(){a.animPrepare=""},1200)},this.OpenProposal=function(){"empty"===r.lastPath&&""!==r.currentPath?(a.animPrepare="proposal-direct",angular.element(document).ready(function(){t(function(){TweenMax.to(".proposal-wrapper",0,{css:{display:"block"}})},30)})):(TweenMax.to(".proposal-paper",0,{y:window.innerHeight}),TweenMax.to(".proposal-wrapper",0,{css:{display:"block"}}),TweenMax.to(".proposal-paper",.6,{y:0,ease:Power3.easeOut}))},this.CloseProposal=function(){TweenMax.to(".proposal-paper",.6,{y:window.innerHeight,ease:Power3.easeIn}),TweenMax.to(".proposal-wrapper",0,{css:{display:"none"},delay:1})}}]),columbaApp.controller("loginController",["$scope","$location","$log","authService","dataService","transitionService",function(e,t,o,r,a,n){e.transitionService=n,n.CheckPreviousState(),e.dataService=a,e.login=function(){r.Login(e.email,e.password)},e.register=function(){r.Register(e.newName,e.newEmail,e.newPassword)},e.emailregistered=!1,e.$watch("newEmail",function(){r.IsEmailRegistered(e.newEmail,function(t){e.emailregistered=t})})}]),columbaApp.controller("dashboardController",["$scope","authService","userService","$location","$log","dataService","transitionService",function(e,t,o,r,a,n,i){e.authService=t,e.transitionService=i;var s=t.EnsureAuthenticated();if(s){e.userName=s,e.$on("$routeUpdate",function(){l(!0)});var l=function(t){r.search().newProposal?i.OpenProposal():(t&&i.CloseProposal(),o.GetAllUsers(function(t){e.users=t}))};l(!1),i.CheckPreviousState()}}]),columbaApp.directive("appHeader",function(){return{templateUrl:"angular/directives/header.html",replace:!0}}),columbaApp.directive("proposalItem",function(){return{templateUrl:"angular/directives/proposal-item.html",replace:!0,scope:{user:"="}}}),columbaApp.directive("proposal",function(){return{templateUrl:"angular/directives/proposal.html",replace:!0}});